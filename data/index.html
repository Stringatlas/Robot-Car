<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no'>
    <title>ESP32 Robot Car</title>
    <link rel="stylesheet" href="/common.css">
    <link rel="stylesheet" href="/components/nav.css">
    <link rel="stylesheet" href="/components/joystick.css">
    <link rel="stylesheet" href="/components/console.css">
    <script src="/components/websocket.js"></script>
    <script src="/components/console.js"></script>
</head>
<body>
    <nav>
        <div class="nav-content">
            <a href="/" class="active">ðŸš— Control</a>
            <a href="/calibration.html" class="inactive">ðŸ”§ Calibration</a>
        </div>
    </nav>
    
    <h1 style="text-align: center; margin: 20px 0;">ESP32 Robot Car</h1>
    <p class="text-center">Status: <span id='status' class='connected'>Connected</span></p>
    <p class="text-center" style="font-size: 18px;">Battery: <span id='battery-voltage' class="text-success font-bold">-- V</span> <span class="text-muted" style="font-size: 12px;">(erratic)</span></p>
    
    <div class="main-layout">
        <!-- Main Content Column -->
        <div class="main-content">
            <div class="joystick-container">
                <h2>Joystick Control</h2>
                
                <!-- Control status and button -->
                <div id='control-status' class="status mb-15">
                    <span id='control-text'>Waiting for connection...</span>
                </div>
                <button id='control-btn' class='button' onclick='toggleControl()' style='display:none;'>Request Control</button>
                
                <div id='joystick' class="disabled">
                    <div id='stick'></div>
                </div>
                <div class="joystick-values">
                    X: <span id='joy-x'>0</span>, Y: <span id='joy-y'>0</span>
                </div>
                <div class="motor-values">
                    Motor L: <span id='motor-left'>0</span> | Motor R: <span id='motor-right'>0</span>
                </div>
            </div>
        
            <div class="encoder-data">
                <h2>Left Encoder</h2>
                <div class="data-row">
                    <span class="data-label">Count:</span>
                    <span class="data-value" id="left-count">0</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Revolutions:</span>
                    <span class="data-value" id="left-revs">0.00</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Distance:</span>
                    <span class="data-value" id="left-dist">0.00 cm</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Velocity:</span>
                    <span class="data-value" id="left-vel">0.00 cm/s</span>
                </div>
                <div class="data-row">
                    <span class="data-label">RPM:</span>
                    <span class="data-value" id="left-rpm">0.0</span>
                </div>
            </div>

            <div class="encoder-data">
                <h2>Right Encoder</h2>
                <div class="data-row">
                    <span class="data-label">Count:</span>
                    <span class="data-value" id="right-count">0</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Revolutions:</span>
                    <span class="data-value" id="right-revs">0.00</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Distance:</span>
                    <span class="data-value" id="right-dist">0.00 cm</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Velocity:</span>
                    <span class="data-value" id="right-vel">0.00 cm/s</span>
                </div>
                <div class="data-row">
                    <span class="data-label">RPM:</span>
                    <span class="data-value" id="right-rpm">0.0</span>
                </div>
            </div>

            <div class="text-center">
                <button class='button' onclick='resetEncoders()'>Reset Encoders</button>
            </div>
        </div>
        
        <!-- Console Sidebar -->
        <div class="console-sidebar">
            <div class="console-container">
                <div class="console-header">
                    <h2>System Console</h2>
                    <button class='button secondary' onclick='clearConsole()' style="padding: 5px 15px; font-size: 12px;">Clear</button>
                </div>
                <div id="console" class="console">
                    <div class="text-muted">Waiting for telemetry...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="/script.js"></script>
</body>
</html>
